<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GreenLaunch • Sustainable Space Missions</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* GreenLaunch Design System */
    :root {
      --space-blue: #0B3D91;
      --space-blue-dark: #082a6b;
      --eco-green: #4CAF50;
      --eco-green-dark: #3d8b40;
      --mars-red: #E27D60;
      --sun-yellow: #FFC107;
      --cosmic-black: #0a0f1f;
      --star-white: #ffffff;
      --moon-gray: #f8fafc;
      --comet-gray: #e2e8f0;
      --asteroid-gray: #64748b;
      
      --primary: var(--space-blue);
      --secondary: var(--eco-green);
      --accent: var(--mars-red);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0B3D91 0%, #1E4FBB 100%);
      color: var(--cosmic-black);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--comet-gray);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 0;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
      text-decoration: none;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--star-white);
    }

    .logo-text {
      font-weight: 800;
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .nav-link {
      color: var(--cosmic-black);
      text-decoration: none;
      font-weight: 500;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-link:hover {
      background: var(--primary);
      color: var(--star-white);
    }

    .portal-btn {
      background: var(--secondary);
      color: var(--star-white);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .portal-btn:hover {
      background: var(--eco-green-dark);
      transform: translateY(-2px);
    }

    /* Hero Section */
    .hero {
      padding: 4rem 0;
      text-align: center;
      color: var(--star-white);
    }

    .hero h1 {
      font-size: 3.5rem;
      font-weight: 800;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .hero p {
      font-size: 1.25rem;
      opacity: 0.9;
      margin-bottom: 3rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Main Content */
    .main-content {
      background: var(--star-white);
      border-radius: 24px 24px 0 0;
      padding: 4rem 0;
      min-height: 80vh;
    }

    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      margin-bottom: 3rem;
    }

    @media (max-width: 968px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Cards */
    .card {
      background: var(--star-white);
      border: 1px solid var(--comet-gray);
      border-radius: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--comet-gray);
      background: var(--moon-gray);
    }

    .card-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--cosmic-black);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Forms */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: var(--cosmic-black);
      margin-bottom: 0.5rem;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--comet-gray);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(11, 61, 145, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--star-white);
    }

    .btn-primary:hover {
      background: var(--space-blue-dark);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--comet-gray);
      color: var(--cosmic-black);
    }

    .btn-success {
      background: var(--secondary);
      color: var(--star-white);
    }

    .btn-success:hover {
      background: var(--eco-green-dark);
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    /* Emission Results */
    .emission-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .emission-stat {
      text-align: center;
      padding: 1rem;
      border-radius: 8px;
      background: var(--moon-gray);
    }

    .emission-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }

    .emission-label {
      font-size: 0.875rem;
      color: var(--asteroid-gray);
      margin-top: 0.25rem;
    }

    .compliance-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .badge-success {
      background: var(--secondary);
      color: var(--star-white);
    }

    .badge-warning {
      background: var(--sun-yellow);
      color: var(--cosmic-black);
    }

    /* AI Brief */
    .ai-brief {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 1px solid #bae6fd;
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
    }

    .ai-brief h4 {
      color: var(--primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Loading States */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading::after {
      content: "";
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 0.5rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--cosmic-black);
      color: var(--star-white);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="/" class="logo">
          <div class="logo-icon">
            <i class="fas fa-leaf"></i>
          </div>
          <div class="logo-text">GreenLaunch</div>
        </a>
        <div class="nav-links">
          <a href="http://localhost:4000" class="portal-btn">
            <i class="fas fa-home"></i>
            Main Portal
          </a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>Calculate Your Space Mission's Environmental Impact</h1>
      <p>Plan sustainable space missions with real-time emission tracking and AI-powered optimization recommendations</p>
    </div>
  </section>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <div class="content-grid">
        <!-- Mission Configuration -->
        <div class="card">
          <div class="card-header">
            <h2><i class="fas fa-rocket"></i> Mission Configuration</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Rocket Type</label>
              <select class="form-control" id="rocketType">
                <option value="falcon9">Falcon 9 - RP-1/LOX</option>
                <option value="newGlenn">New Glenn - Methalox</option>
                <option value="ariane6">Ariane 6 - Hydrolox + SRB</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Destination</label>
              <select class="form-control" id="destination">
                <option value="moon">Moon (384,000 km)</option>
                <option value="mars">Mars (225M km)</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Launch Site</label>
                <select class="form-control" id="launchSite">
                  <option value="timmins">Timmins Stratospheric Facility</option>
                  <option value="chapleau">Chapleau Northern Range</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Payload Mass (kg)</label>
                <input type="number" class="form-control" id="payloadMass" placeholder="e.g., 2750">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">AI Brief Tone</label>
              <select class="form-control" id="tone">
                <option value="educator">Educator</option>
                <option value="student-friendly">Student Friendly</option>
                <option value="technical">Technical</option>
                <option value="executive">Executive</option>
              </select>
            </div>

            <div class="form-row">
              <button class="btn btn-primary btn-full" onclick="calculateEmissions()">
                <i class="fas fa-calculator"></i>
                Calculate Emissions
              </button>
              <button class="btn btn-success btn-full" onclick="generateAIBrief()">
                <i class="fas fa-robot"></i>
                AI Mission Brief
              </button>
              <button class="btn btn-secondary btn-full" onclick="generateRiskReport()">
                <i class="fas fa-triangle-exclamation"></i>
                Risk Report
              </button>
            </div>
          </div>
        </div>

        <!-- Results Panel -->
        <div class="card">
          <div class="card-header">
            <h2><i class="fas fa-chart-bar"></i> Emission Results</h2>
          </div>
          <div style="margin-top:1.5rem;">
            <h4 style="margin-bottom:0.75rem;">Risk Report</h4>
            <div id="riskReportContainer" class="ai-brief" style="display:none;"></div>
          </div>
          
          <div class="card-body">
            <div id="resultsPlaceholder" style="text-align: center; padding: 3rem; color: var(--asteroid-gray);">
              <i class="fas fa-rocket" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
              <h3>Configure Your Mission</h3>
              <p>Select rocket, destination, and payload to see emission analysis</p>
            </div>

            <div id="emissionResults" style="display: none;">
              <h3 id="missionTitle" style="margin-bottom: 1.5rem;"></h3>
              
              <div class="emission-stats">
                <div class="emission-stat">
                  <div class="emission-value" id="co2Value">0</div>
                  <div class="emission-label">CO₂ Emissions</div>
                </div>
                <div class="emission-stat">
                  <div class="emission-value" id="noxValue">0</div>
                  <div class="emission-label">NOx Emissions</div>
                </div>
                <div class="emission-stat">
                  <div class="emission-value" id="carbonValue">0</div>
                  <div class="emission-label">Black Carbon</div>
                </div>
                <div class="emission-stat">
                  <div class="emission-value" id="waterValue">0</div>
                  <div class="emission-label">Water Vapor</div>
                </div>
              </div>

              <div style="margin: 1.5rem 0;">
                <h4 style="margin-bottom: 1rem;">Emission Intensity</h4>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Per kg Payload</label>
                    <div class="form-control" id="perKgPayload">0 kg CO₂/kg</div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Per km Traveled</label>
                    <div class="form-control" id="perKm">0 kg CO₂/km</div>
                  </div>
                </div>
              </div>

              <div style="margin: 1.5rem 0;">
                <h4 style="margin-bottom: 1rem;">Regulatory Compliance</h4>
                <div id="complianceStatus"></div>
              </div>

              <div id="aiBriefSection" class="ai-brief" style="display: none;">
                <h4><i class="fas fa-robot"></i> AI Sustainability Brief</h4>
                <div id="aiBriefContent"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reference Data -->
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-database"></i> Rocket & Launch Site Reference</h2>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <button class="btn btn-secondary btn-full" onclick="loadReferenceData()">
                <i class="fas fa-sync"></i>
                Load Reference Data
              </button>
            </div>
          </div>
          <div id="referenceData" style="display: none;">
            <!-- Reference data will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script>
    const BASE_URL = 'http://localhost:4020/api/greenlaunch';

    // Utility functions
    function $(id) { return document.getElementById(id); }
    
    function showToast(message, type = 'info') {
      const toast = $('toast');
      toast.textContent = message;
      toast.className = `toast show`;
      setTimeout(() => toast.className = 'toast', 3000);
    }

    function formatNumber(num) {
      return new Intl.NumberFormat().format(num);
    }

    // API Functions
    async function calculateEmissions() {
      const btn = event.target;
      btn.classList.add('loading');
      
      try {
        const payload = {
          rocketId: $('rocketType').value,
          destination: $('destination').value,
          launchSite: $('launchSite').value,
          payloadMassKg: Number($('payloadMass').value) || undefined
        };

        const response = await fetch(`${BASE_URL}/estimate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error('Failed to calculate emissions');
        
        const data = await response.json();
        displayEmissionResults(data.summary);
        showToast('Emission calculation completed!');
        
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      } finally {
        btn.classList.remove('loading');
      }
    }

    async function generateAIBrief() {
      const btn = event.target;
      btn.classList.add('loading');
      
      try {
        const payload = {
          rocketId: $('rocketType').value,
          destination: $('destination').value,
          launchSite: $('launchSite').value,
          payloadMassKg: Number($('payloadMass').value) || undefined,
          tone: $('tone').value
        };

        const response = await fetch(`${BASE_URL}/brief`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error('Failed to generate AI brief');
        
        const data = await response.json();
        displayAIBrief(data.advisory);
        showToast('AI mission brief generated!');
        
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      } finally {
        btn.classList.remove('loading');
      }
    }

    async function loadReferenceData() {
      const btn = event.target;
      btn.classList.add('loading');
      
      try {
        const response = await fetch(`${BASE_URL}/reference`);
        if (!response.ok) throw new Error('Failed to load reference data');
        
        const data = await response.json();
        displayReferenceData(data);
        showToast('Reference data loaded!');
        
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      } finally {
        btn.classList.remove('loading');
      }
    }

    // Display Functions
    function displayEmissionResults(summary) {
      $('resultsPlaceholder').style.display = 'none';
      $('emissionResults').style.display = 'block';
      
      // Update mission title
      $('missionTitle').textContent = 
        `${summary.rocket} to ${summary.destination} from ${summary.launchSite}`;
      
      // Update emission values
      $('co2Value').textContent = formatNumber(summary.totalsKg.co2) + ' kg';
      $('noxValue').textContent = formatNumber(summary.totalsKg.nox) + ' kg';
      $('carbonValue').textContent = formatNumber(summary.totalsKg.blackCarbon) + ' kg';
      $('waterValue').textContent = formatNumber(summary.totalsKg.waterVapor) + ' kg';
      
      // Update intensity
      $('perKgPayload').textContent = `${summary.intensity.perKgPayload} kg CO₂/kg`;
      $('perKm').textContent = `${summary.intensity.perKm} kg CO₂/km`;
      
      // Update compliance
      const complianceDiv = $('complianceStatus');
      const isCompliant = summary.compliance.transportCanada === 'standard';
      
      complianceDiv.innerHTML = `
        <div class="compliance-badge ${isCompliant ? 'badge-success' : 'badge-warning'}">
          <i class="fas fa-${isCompliant ? 'check' : 'exclamation-triangle'}"></i>
          Transport Canada: ${isCompliant ? 'Compliant' : 'Review Required'}
        </div>
        ${summary.compliance.indigenousConsultationRequired ? `
          <div style="margin-top: 0.5rem;">
            <strong>Indigenous Consultation Required:</strong> Yes
          </div>
        ` : ''}
        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--asteroid-gray);">
          ${summary.compliance.additionalNotes.join(' • ')}
        </div>
      `;
    }

    function displayAIBrief(advisory) {
      $('aiBriefSection').style.display = 'block';
      $('aiBriefContent').innerHTML = `
        <div style="white-space: pre-wrap; line-height: 1.6;">${advisory}</div>
      `;
    }

    async function generateRiskReport() {
  const btn = event.target;
  btn.classList.add('loading');
  try {
    const payload = {
      rocketId: $('rocketType').value,
      destination: $('destination').value,
      launchSite: $('launchSite').value,
      payloadMassKg: Number($('payloadMass').value) || undefined
    };

    const resp = await fetch(`${BASE_URL}/risk`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if (!resp.ok) throw new Error('Failed to compute risk report');

    const { risk } = await resp.json();
    displayRiskReport(risk);
    showToast('Risk report ready!');
  } catch (e) {
    showToast('Error: ' + e.message, 'error');
  } finally {
    btn.classList.remove('loading');
  }
}

function pill(score) {
  const clr = score >= 70 ? '#E27D60' : score >= 40 ? '#FFC107' : '#4CAF50';
  const txt = score >= 70 ? 'High' : score >= 40 ? 'Med' : 'Low';
  return `<span style="display:inline-block;margin:.25rem 0;padding:.25rem .6rem;border-radius:999px;background:${clr};color:#fff;font-weight:700">${txt} ${score}</span>`;
}

function displayRiskReport(risk) {
  const el = $('riskReportContainer');
  el.style.display = 'block';
  const d = risk.dimensions;

  el.innerHTML = `
    <div><strong>Overall:</strong> ${pill(risk.overall.score)} <small style="color:#64748b;">(${risk.overall.label})</small></div>
    <div style="margin-top:.75rem;display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;">
      <div><strong>CO₂:</strong> ${pill(d.co2Risk)}</div>
      <div><strong>NOx:</strong> ${pill(d.noxRisk)}</div>
      <div><strong>Efficiency:</strong> ${pill(d.efficiencyRisk)}</div>
      <div><strong>Compliance:</strong> ${pill(d.complianceRisk)}</div>
      <div><strong>Local Env:</strong> ${pill(d.localEnvRisk)}</div>
    </div>
    <div style="margin-top:1rem;">
      <strong>Recommendations:</strong>
      <ul style="margin:.5rem 0 0 1.25rem;">
        ${risk.recommendations.map(r => `<li>${r}</li>`).join('')}
      </ul>
    </div>
  `;
}


    function displayReferenceData(data) {
      $('referenceData').style.display = 'block';
      $('referenceData').innerHTML = `
        <div class="form-row">
          <div class="form-group">
            <h4>Rocket Profiles</h4>
            <div style="max-height: 200px; overflow-y: auto;">
              ${Object.entries(data.rockets).map(([key, rocket]) => `
                <div style="padding: 0.75rem; border: 1px solid var(--comet-gray); border-radius: 8px; margin-bottom: 0.5rem;">
                  <strong>${rocket.displayName}</strong><br>
                  <small>Fuel: ${rocket.fuelType} • CO₂: ${formatNumber(rocket.baseCO2PerLaunchKg)} kg</small>
                </div>
              `).join('')}
            </div>
          </div>
          <div class="form-group">
            <h4>Ontario Launch Sites</h4>
            <div style="max-height: 200px; overflow-y: auto;">
              ${Object.entries(data.ontarioLaunchSites).map(([key, site]) => `
                <div style="padding: 0.75rem; border: 1px solid var(--comet-gray); border-radius: 8px; margin-bottom: 0.5rem;">
                  <strong>${site.name}</strong><br>
                  <small>Weather Penalty: ${site.localWeatherPenalty}x</small>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // Initialize with some default values
    document.addEventListener('DOMContentLoaded', function() {
      // Set default payload mass based on selected rocket
      $('rocketType').addEventListener('change', function() {
        const capacities = {
          falcon9: 2750,
          newGlenn: 6000,
          ariane6: 3200
        };
        $('payloadMass').value = capacities[this.value] || '';
      });
      
      // Trigger change to set initial value
      $('rocketType').dispatchEvent(new Event('change'));
    });
  </script>
</body>
</html>