<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PlanetMode Mission Control</title>
<style>
:root {
  --bg: #0d1117;
  --panel: #161b22;
  --card: #1b1f27;
  --text: #e6e9ef;
  --accent: #2698ff;      /* Primary blue */
  --accent-light: #5ab3ff;
  --border: #2a2f36;
  --muted: #aeb7c4;
}

body {
  font-family: "Inter", sans-serif;
  background: var(--bg);
  margin: 0;
  color: var(--text);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* ===== Header ===== */
header {
  background: var(--panel);
  padding: 22px 0 12px;
  text-align: center;
  font-size: 1.7rem;
  font-weight: 600;
  border-bottom: 1px solid var(--border);
  letter-spacing: 0.5px;
}
#syncStatus {
  font-size: 0.88rem;
  margin-top: 4px;
  color: var(--muted);
}

/* ===== Dashboard Layout ===== */
main {
  display: flex;
  gap: 22px;
  flex: 1;
  padding: 22px;
}

/* ===== Sidebar Controls ===== */
.controls {
  width: 300px;
  background: var(--panel);
  padding: 22px;
  border-radius: 10px;
  border: 1px solid var(--border);
}

.controls h3 {
  margin: 0;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
  color: var(--accent-light);
}

label { display: block; margin-top: 14px; font-size: 0.95rem; }

select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
}

button {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  background: var(--accent);
  color: #fff;
  font-weight: 600;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: 0.25s;
}
button:hover {
  background: var(--accent-light);
}

/* ===== Main Grid ===== */
.dashboard {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
  gap: 22px;
}

.card {
  background: var(--card);
  border-radius: 10px;
  padding: 20px;
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
}

.card h3 {
  margin: 0;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
  color: var(--accent-light);
}

/* ===== Generic Tables ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  font-size: 0.92rem;
}

th {
  text-align: left;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
  color: var(--accent-light);
}

td {
  padding: 8px 4px;
  border-bottom: 1px solid var(--border);
  color: var(--text);
}

/* ===== Missions ===== */
.mission {
  background: var(--panel);
  padding: 14px;
  border-radius: 6px;
  border-left: 4px solid var(--accent);
  margin-bottom: 8px;
  line-height: 1.45;
}

/* ===== Loader Overlay ===== */
#loader {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(13, 17, 23, 0.85);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: var(--accent-light);
  z-index: 9999;
  backdrop-filter: blur(4px);
}

.spinner {
  border: 4px solid rgba(255,255,255,0.15);
  border-top: 4px solid var(--accent-light);
  border-radius: 50%;
  width: 60px;
  height: 60px;
  margin-bottom: 14px;
  animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== Footer ===== */
footer {
  padding: 16px;
  text-align: center;
  font-size: 0.85rem;
  color: var(--muted);
  border-top: 1px solid var(--border);
}
</style>

    
    
</head>

<body>
  <header>
    üöÄ PlanetMode Mission Control Dashboard
    <button id="themeToggle">üåô Dark</button>
    <div id="syncStatus">üõ∞ Awaiting first sync...</div>
  </header>

  <main>
    <div class="controls">
      <h3>Simulation Controls</h3>
      <label>Planet</label>
      <select id="planet"><option>Earth</option><option>Moon</option><option>Mars</option></select>
      <label>Vehicle</label>
      <select id="vehicle"><option>Apollo LM</option><option>Starship</option><option>Curiosity Rover</option></select>
      <label>Landing Site (Earth only)</label>
      <select id="site"><option>Timmins</option><option>Capio</option></select>
      <button id="runSimulation">Run Full Simulation</button>
    </div>

    <div class="dashboard">
      <div class="card" id="cardSim"><h3>Simulation Results</h3><div id="simResults">No data yet.</div></div>
      <div class="card" id="cardWeather"><h3>Planetary Weather</h3><div id="weatherGrid">No data yet.</div></div>
      <div class="card" id="cardNeo"><h3>Near-Earth Objects</h3><div id="neoData">No data yet.</div></div>
      <div class="card" id="cardMission"><h3>Generated Missions <span id="missionCount">‚Äî</span></h3><div id="missionsList">No missions yet.</div></div>
    </div>
  </main>

  <footer>¬© 2025 PlanetMode Systems | Gemini + NASA APIs</footer>

  <div id="loader">
    <div class="spinner"></div>
    <div id="loaderText">Initializing mission...</div>
  </div>

  <script>
    const runBtn = document.getElementById("runSimulation");
    const simResults = document.getElementById("simResults");
    const missionsList = document.getElementById("missionsList");
    const missionCount = document.getElementById("missionCount");
    const weatherGrid = document.getElementById("weatherGrid");
    const neoData = document.getElementById("neoData");
    const syncStatus = document.getElementById("syncStatus");
    const loader = document.getElementById("loader");
    const planetEl = document.getElementById("planet");
    const vehicleEl = document.getElementById("vehicle");
    const siteEl = document.getElementById("site");
    const themeToggle = document.getElementById("themeToggle");

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light");
      themeToggle.textContent = document.body.classList.contains("light") ? "üåû Light" : "üåô Dark";
    });

    async function runFullSimulation() {
      const planet = planetEl.value;
      const vehicle = vehicleEl.value;
      const site = siteEl.value;
      loader.style.display = "flex";

      try {
        const res = await fetch("/planetmode/gemini-simulate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ planet, vehicle, site })
        });
        const data = await res.json();

        const r = data.results || {};
        simResults.innerHTML = `
          <b>Planet:</b> ${planet}<br><b>Vehicle:</b> ${vehicle}<br><b>Site:</b> ${site}<hr>
          Crater: ${r.craterDiameter || "N/A"}<br>
          Dust: ${r.dustRadius || "N/A"}<br>
          Seismic: ${r.seismicMagnitude || "N/A"}<br>
          Contamination: ${r.contaminationLevel || "N/A"}<br>
          Env. Score: ${r.environmentalScore || "N/A"}<hr>
          <i>${data.summary || "No summary available."}</i>`;

        const w = data.weather || {};
        weatherGrid.innerHTML = `
          <table>
            <tr><th>Planet</th><th>Temperature</th><th>Humidity / Pressure</th><th>Condition / Summary</th></tr>
            <tr><td><span class="planet-icon planet-earth"></span> Earth (${w.Earth?.city || site})</td>
                <td>${w.Earth?.temp ?? "N/A"} ¬∞C</td>
                <td>${w.Earth?.humidity ?? "‚Äî"}%</td>
                <td>${w.Earth?.condition || "N/A"}</td></tr>
            <tr><td><span class="planet-icon planet-mars"></span> Mars</td>
                <td>${w.Mars?.tempAvg ?? "N/A"} ¬∞C</td>
                <td>${w.Mars?.pressure ?? "‚Äî"} Pa</td>
                <td>Wind: ${w.Mars?.wind ?? "N/A"}</td></tr>
            <tr><td><span class="planet-icon planet-moon"></span> Moon</td>
                <td>‚Äî</td><td>‚Äî</td>
                <td>${w.Moon?.summary || "No atmosphere, extreme temperature fluctuations."}</td></tr>
          </table>`;

        // ---- NEO TABLE ----
        const neo = data.neo || {};
        if (neo.error) {
          neoData.innerHTML = `<p>${neo.error}</p>`;
        } else {
          const c = neo.closest || {};
          neoData.innerHTML = `
            <table>
              <tr><th>Metric</th><th>Value</th></tr>
              <tr><td>Total Objects</td><td>${neo.totalObjects ?? "N/A"}</td></tr>
              <tr><td>Hazardous Count</td><td>${neo.hazardousCount ?? "N/A"}</td></tr>
              <tr><td>Closest Object</td><td>${c.name || "N/A"}</td></tr>
              <tr><td>Miss Distance</td><td>${c.missDistance_km ? c.missDistance_km.toFixed(2) + " km" : "N/A"}</td></tr>
              <tr><td>Velocity</td><td>${c.relativeVelocity_km_s ? c.relativeVelocity_km_s.toFixed(2) + " km/s" : "N/A"}</td></tr>
              <tr><td>Orbiting Body</td><td>${c.orbitingBody || "N/A"}</td></tr>
              <tr><td>Hazardous?</td><td>${c.isHazardous ? "‚ö†Ô∏è Yes" : "No"}</td></tr>
            </table>`;
        }

        // ---- MISSIONS ----
        const missionRes = await fetch(`/planetmode/gemini-missions?planet=${planet}&vehicle=${vehicle}&count=3`);
        const mData = await missionRes.json();
        const missions = mData.missions || [];
        missionCount.textContent = `${missions.length} missions`;
        missionsList.innerHTML = missions.map(m => `
          <div class="mission">
            <b>${m.missionName}</b> (${m.era}, ${m.status})<br>
            ${m.scenario?.bodyId || ""} ‚Äî ${m.scenario?.landingSite?.name || ""}<br>
            Vehicle: ${m.scenario?.vehicle?.name || ""}<br><br>
            Scientific: ${m.scoring?.scientificValue}%<br>
            Safety: ${m.scoring?.safety}%<br>
            Efficiency: ${m.scoring?.efficiency}%<br>
            Overall: ${m.scoring?.overall}%
          </div>`).join("");
        syncStatus.textContent = "üõ∞ Synced ‚Äî Gemini + NASA data loaded.";
      } catch (err) {
        simResults.innerHTML = `<p>‚ùå ${err.message}</p>`;
      } finally {
        loader.style.display = "none";
      }
    }

    runBtn.addEventListener("click", runFullSimulation);
  </script>
</body>
</html>
